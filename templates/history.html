<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis History - Skin Cancer Classifier</title>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link rel="stylesheet" as="style" onload="this.rel='stylesheet'" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Inter%3Awght%40400%3B500%3B700%3B900&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='app.css') }}">
</head>
<body>
    <!-- Mobile Nav (Hamburger) -->
    <div class="md:hidden flex items-center justify-between px-4 py-3 bg-[#141a1f] border-b border-[#2b3640]">
      <button id="mobileMenuButton" class="text-white focus:outline-none">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
      <div class="flex items-center gap-3">
        <button id="themeToggle" class="theme-toggle">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24">
            <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <a href="{{ url_for('profile_page') }}" class="text-white hover:bg-[#2b3640] p-2 rounded-lg transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256">
            <path d="M117.25,157.92a60,60,0,1,0-66.5,0A95.83,95.83,0,0,0,3.53,195.63a8,8,0,1,0,13.4,8.74,80,80,0,0,1,134.14,0,8,8,0,0,0,13.4-8.74A95.83,95.83,0,0,0,117.25,157.92ZM40,108a44,44,0,1,1,44,44A44.05,44.05,0,0,1,40,108Zm210.14,98.7a8,8,0,0,1-11.07-2.33A79.83,79.83,0,0,0,172,168a8,8,0,0,1,0-16,44,44,0,1,0-16.34-84.87,8,8,0,0,1-5.94-14.85,60,60,0,0,1,55.53,105.64,95.83,95.83,0,0,1,47.22,37.71A8,8,0,0,1,250.14,206.7Z"></path>
          </svg>
        </a>
        <a href="{{ url_for('settings_page') }}" class="text-white hover:bg-[#2b3640] p-2 rounded-lg transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256">
            <path d="M128,80a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160Zm88-29.84q.06-2.16,0-4.32l14.92-18.64a8,8,0,0,0,1.48-7.06,107.21,107.21,0,0,0-10.88-26.25a8,8,0,0,0-6-3.93l-23.72-2.64q-1.48-1.56-3-3L186,40.54a8,8,0,0,0-3.94-6,107.71,107.71,0,0,0-26.25-10.87a8,8,0,0,0-7.06,1.49L130.16,40Q128,40,125.84,40L107.2,25.11a8,8,0,0,0-7.06-1.48A107.6,107.6,0,0,0,73.89,34.51a8,8,0,0,0-3.93,6L67.32,64.27q-1.56,1.49-3,3L40.54,70a8,8,0,0,0-6,3.94,107.71,107.71,0,0,0-10.87,26.25a8,8,0,0,0,1.49,7.06L40,125.84Q40,128,40,130.16L25.11,148.8a8,8,0,0,0-1.48,7.06,107.21,107.21,0,0,0,10.88,26.25a8,8,0,0,0,6,3.93l23.72,2.64q1.49,1.56,3,3L70,215.46a8,8,0,0,0,3.94,6,107.71,107.71,0,0,0,26.25,10.87a8,8,0,0,0,7.06-1.49L125.84,216q2.16.06,4.32,0l18.64,14.92a8,8,0,0,0,7.06,1.48,107.21,107.21,0,0,0,26.25-10.88a8,8,0,0,0,3.93-6l2.64-23.72q1.56-1.48,3-3L215.46,186a8,8,0,0,0,6-3.94,107.71,107.71,0,0,0,10.87-26.25a8,8,0,0,0-1.49-7.06Zm-16.1-6.5a73.93,73.93,0,0,1,0,8.68,8,8,0,0,0,1.74,5.48l14.19,17.73a91.57,91.57,0,0,1-6.23,15L187,173.11a8,8,0,0,0-5.1,2.64,74.11,74.11,0,0,1-6.14,6.14,8,8,0,0,0-2.64,5.1l-2.51,22.58a91.32,91.32,0,0,1-15,6.23l-17.74-14.19a8,8,0,0,0-5-1.75h-.48a73.93,73.93,0,0,1-8.68,0,8,8,0,0,0-5.48,1.74L100.45,215.8a91.57,91.57,0,0,1-15-6.23L82.89,187a8,8,0,0,0-2.64-5.1,74.11,74.11,0,0,1-6.14-6.14,8,8,0,0,0-5.1-2.64L46.43,170.6a91.32,91.32,0,0,1-6.23-15l14.19-17.74a8,8,0,0,0,1.74-5.48,73.93,73.93,0,0,1,0-8.68,8,8,0,0,0-1.74-5.48L40.2,100.45a91.57,91.57,0,0,1,6.23-15L69,82.89a8,8,0,0,0,5.1-2.64,74.11,74.11,0,0,1,6.14-6.14A8,8,0,0,0,82.89,69L85.4,46.43a91.32,91.32,0,0,1,15-6.23l17.74,14.19a8,8,0,0,0,5.48,1.74,73.93,73.93,0,0,1,8.68,0,8,8,0,0,0,5.48-1.74L155.55,40.2a91.57,91.57,0,0,1,15,6.23L173.11,69a8,8,0,0,0,2.64,5.1,74.11,74.11,0,0,1,6.14,6.14,8,8,0,0,0,5.1,2.64l22.58,2.51a91.32,91.32,0,0,1,6.23,15l-14.19,17.74A8,8,0,0,0,199.87,123.66Z"></path>
          </svg>
        </a>
      </div>
    </div>
    <div class="relative flex size-full min-h-screen flex-col bg-[#141a1f] group/design-root overflow-x-hidden" style='font-family: Inter, "Noto Sans", sans-serif;'>
        <div class="layout-container flex h-full grow flex-col">
            <div class="gap-1 px-6 flex flex-1 justify-center py-5">
                <!-- Sidebar -->
                <div id="sidebarMenu" class="layout-content-container flex flex-col w-80 md:static fixed top-0 left-0 h-full z-40 bg-[#141a1f] transition-transform duration-300 md:translate-x-0 -translate-x-full shadow-lg md:shadow-none md:block">
                    <div class="flex h-full min-h-[700px] flex-col justify-between bg-[#141a1f] p-4">
                        <div class="flex flex-col gap-4">
                            <div class="flex items-center justify-end">
                                <button id="closeSidebar" class="md:hidden text-white">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>
                            <div class="flex flex-col gap-2">
                                <a href="{{ url_for('home') }}" class="flex items-center gap-3 px-3 py-2 hover:bg-[#2b3640] rounded-xl transition-colors">
                                    <div class="text-white" data-icon="House" data-size="24px" data-weight="regular">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                                            <path d="M224,115.55V208a16,16,0,0,1-16,16H168a16,16,0,0,1-16-16V168a8,8,0,0,0-8-8H112a8,8,0,0,0-8,8v40a16,16,0,0,1-16,16H48a16,16,0,0,1-16-16V115.55a16,16,0,0,1,5.17-11.78l80-75.48.11-.11a16,16,0,0,1,21.53,0,1.14,1.14,0,0,0,.11.11l80,75.48A16,16,0,0,1,224,115.55Z"></path>
                                        </svg>
                                    </div>
                                    <p class="text-white text-sm font-medium leading-normal">Dashboard</p>
                                </a>
                                <a href="{{ url_for('upload_page') }}" class="flex items-center gap-3 px-3 py-2 hover:bg-[#2b3640] rounded-xl transition-colors">
                                    <div class="text-white" data-icon="File" data-size="24px" data-weight="regular">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                                            <path d="M213.66,82.34l-56-56A8,8,0,0,0,152,24H56A16,16,0,0,0,40,40V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V88A8,8,0,0,0,213.66,82.34ZM160,51.31,188.69,80H160ZM200,216H56V40h88V88a8,8,0,0,0,8,8h48V216Z"></path>
                                        </svg>
                                    </div>
                                    <p class="text-white text-sm font-medium leading-normal">Upload Image</p>
                                </a>
                                <div class="flex items-center gap-3 px-3 py-2 rounded-xl bg-[#2b3640]">
                                    <div class="text-white" data-icon="PresentationChart" data-size="24px" data-weight="fill">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                                            <path d="M216,40H136V24a8,8,0,0,0-16,0V40H40A16,16,0,0,0,24,56V176a16,16,0,0,0,16,16H79.36L57.75,219a8,8,0,0,0,12.5,10l29.59-37h56.32l29.59,37a8,8,0,1,0,12.5-10l-21.61-27H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40Zm0,136H40V56H216V176ZM104,120v24a8,8,0,0,1-16,0V120a8,8,0,0,1,16,0Zm32-16v40a8,8,0,0,1-16,0V104a8,8,0,0,1,16,0Zm32-16v56a8,8,0,0,1-16,0V88a8,8,0,0,1,16,0Z"></path>
                                        </svg>
                                    </div>
                                    <p class="text-white text-sm font-medium leading-normal">Analysis History</p>
                                </div>
                                <a href="{{ url_for('profile_page') }}" class="flex items-center gap-3 px-3 py-2 hover:bg-[#2b3640] rounded-xl transition-colors">
                                    <div class="text-white" data-icon="Users" data-size="24px" data-weight="regular">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                                            <path d="M117.25,157.92a60,60,0,1,0-66.5,0A95.83,95.83,0,0,0,3.53,195.63a8,8,0,1,0,13.4,8.74,80,80,0,0,1,134.14,0,8,8,0,0,0,13.4-8.74A95.83,95.83,0,0,0,117.25,157.92ZM40,108a44,44,0,1,1,44,44A44.05,44.05,0,0,1,40,108Zm210.14,98.7a8,8,0,0,1-11.07-2.33A79.83,79.83,0,0,0,172,168a8,8,0,0,1,0-16,44,44,0,1,0-16.34-84.87,8,8,0,0,1-5.94-14.85,60,60,0,0,1,55.53,105.64,95.83,95.83,0,0,1,47.22,37.71A8,8,0,0,1,250.14,206.7Z"></path>
                                        </svg>
                                    </div>
                                    <p class="text-white text-sm font-medium leading-normal">User Profile</p>
                                </a>
                                <a href="{{ url_for('settings_page') }}" class="flex items-center gap-3 px-3 py-2 hover:bg-[#2b3640] rounded-xl transition-colors">
                                    <div class="text-white" data-icon="Gear" data-size="24px" data-weight="regular">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                                            <path d="M128,80a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160Zm88-29.84q.06-2.16,0-4.32l14.92-18.64a8,8,0,0,0,1.48-7.06,107.21,107.21,0,0,0-10.88-26.25,8,8,0,0,0-6-3.93l-23.72-2.64q-1.48-1.56-3-3L186,40.54a8,8,0,0,0-3.94-6,107.71,107.71,0,0,0-26.25-10.87,8,8,0,0,0-7.06,1.49L130.16,40Q128,40,125.84,40L107.2,25.11a8,8,0,0,0-7.06-1.48A107.6,107.6,0,0,0,73.89,34.51a8,8,0,0,0-3.93,6L67.32,64.27q-1.56,1.49-3,3L40.54,70a8,8,0,0,0-6,3.94,107.71,107.71,0,0,0-10.87,26.25,8,8,0,0,0,1.49,7.06L40,125.84Q40,128,40,130.16L25.11,148.8a8,8,0,0,0-1.48,7.06,107.21,107.21,0,0,0,10.88,26.25,8,8,0,0,0,6,3.93l23.72,2.64q1.49,1.56,3,3L70,215.46a8,8,0,0,0,3.94,6,107.71,107.71,0,0,0,26.25,10.87,8,8,0,0,0,7.06-1.49L125.84,216q2.16.06,4.32,0l18.64,14.92a8,8,0,0,0,7.06,1.48,107.21,107.21,0,0,0,26.25-10.88,8,8,0,0,0,3.93-6l2.64-23.72q1.56-1.48,3-3L215.46,186a8,8,0,0,0,6-3.94,107.71,107.71,0,0,0,10.87-26.25,8,8,0,0,0-1.49-7.06Zm-16.1-6.5a73.93,73.93,0,0,1,0,8.68,8,8,0,0,0,1.74,5.48l14.19,17.73a91.57,91.57,0,0,1-6.23,15L187,173.11a8,8,0,0,0-5.1,2.64,74.11,74.11,0,0,1-6.14,6.14,8,8,0,0,0-2.64,5.1l-2.51,22.58a91.32,91.32,0,0,1-15,6.23l-17.74-14.19a8,8,0,0,0-5-1.75h-.48a73.93,73.93,0,0,1-8.68,0,8,8,0,0,0-5.48,1.74L100.45,215.8a91.57,91.57,0,0,1-15-6.23L82.89,187a8,8,0,0,0-2.64-5.1,74.11,74.11,0,0,1-6.14-6.14,8,8,0,0,0-5.1-2.64L46.43,170.6a91.32,91.32,0,0,1-6.23-15l14.19-17.74a8,8,0,0,0,1.74-5.48,73.93,73.93,0,0,1,0-8.68,8,8,0,0,0-1.74-5.48L40.2,100.45a91.57,91.57,0,0,1,6.23-15L69,82.89a8,8,0,0,0,5.1-2.64,74.11,74.11,0,0,1,6.14-6.14A8,8,0,0,0,82.89,69L85.4,46.43a91.32,91.32,0,0,1,15-6.23l17.74,14.19a8,8,0,0,0,5.48,1.74,73.93,73.93,0,0,1,8.68,0,8,8,0,0,0,5.48-1.74L155.55,40.2a91.57,91.57,0,0,1,15,6.23L173.11,69a8,8,0,0,0,2.64,5.1,74.11,74.11,0,0,1,6.14,6.14,8,8,0,0,0,5.1,2.64l22.58,2.51a91.32,91.32,0,0,1,6.23,15l-14.19,17.74A8,8,0,0,0,199.87,123.66Z"></path>
                                        </svg>
                                    </div>
                                    <p class="text-white text-sm font-medium leading-normal">Settings</p>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
                    <div class="flex flex-wrap justify-between gap-3 p-4">
                        <p class="text-white tracking-light text-[32px] font-bold leading-tight min-w-72">Analysis History</p>
                        <a href="{{ url_for('upload_page') }}" class="px-6 py-2 bg-[#dce8f3] text-[#141a1f] rounded-xl font-semibold hover:bg-[#b8d4e8] transition-colors">
                            New Analysis
                        </a>
                    </div>

                    <!-- Stats Cards -->
                    <div class="px-4 py-3">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                            <div class="bg-gradient-to-r from-[#1f272e] to-[#2b3640] rounded-xl p-4 border border-[#3d4d5c]">
                                <div class="text-center">
                                    <div class="text-[#dce8f3] text-2xl font-bold" id="totalAnalyses">0</div>
                                    <div class="text-[#9daebe] text-sm">Total Analyses</div>
                                </div>
                            </div>
                            <div class="bg-gradient-to-r from-[#1f272e] to-[#2b3640] rounded-xl p-4 border border-[#3d4d5c]">
                                <div class="text-center">
                                    <div class="text-green-400 text-2xl font-bold" id="benignCount">0</div>
                                    <div class="text-[#9daebe] text-sm">Benign</div>
                                </div>
                            </div>
                            <div class="bg-gradient-to-r from-[#1f272e] to-[#2b3640] rounded-xl p-4 border border-[#3d4d5c]">
                                <div class="text-center">
                                    <div class="text-red-400 text-2xl font-bold" id="malignantCount">0</div>
                                    <div class="text-[#9daebe] text-sm">Malignant</div>
                                </div>
                            </div>
                            <div class="bg-gradient-to-r from-[#1f272e] to-[#2b3640] rounded-xl p-4 border border-[#3d4d5c]">
                                <div class="text-center">
                                    <div class="text-[#dce8f3] text-2xl font-bold" id="accuracyRate">0%</div>
                                    <div class="text-[#9daebe] text-sm">Accuracy</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="px-4 py-3">
                        <div class="bg-[#1f272e] rounded-xl p-4 border border-[#3d4d5c]">
                            <div class="flex flex-col md:flex-row gap-4 items-stretch md:items-center">
                                <div class="flex-1">
                                    <label class="block text-white text-sm font-medium mb-2">Search</label>
                                    <input type="text" id="searchInput" placeholder="Search by image name..." 
                                           class="w-full px-4 py-2 rounded-lg border border-[#3d4d5c] bg-[#141a1f] text-white placeholder:text-[#9daebe] focus:outline-none focus:border-[#dce8f3]">
                                </div>
                                <div class="w-full md:w-auto">
                                    <label class="block text-white text-sm font-medium mb-2">Filter by Result</label>
                                    <select id="filterResult" class="w-full md:w-auto px-4 py-2 rounded-lg border border-[#3d4d5c] bg-[#141a1f] text-white focus:outline-none focus:border-[#dce8f3]">
                                        <option value="">All Results</option>
                                        <option value="Benign">Benign</option>
                                        <option value="Malignant">Malignant</option>
                                    </select>
                                </div>
                                <div class="w-full md:w-auto">
                                    <label class="block text-white text-sm font-medium mb-2">Sort by</label>
                                    <select id="sortBy" class="w-full md:w-auto px-4 py-2 rounded-lg border border-[#3d4d5c] bg-[#141a1f] text-white focus:outline-none focus:border-[#dce8f3]">
                                        <option value="date_desc">Date (Newest)</option>
                                        <option value="date_asc">Date (Oldest)</option>
                                        <option value="name_asc">Name (A-Z)</option>
                                        <option value="name_desc">Name (Z-A)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- History Table -->
                    <div class="px-4 py-3">
                        <div class="bg-[#1f272e] rounded-xl border border-[#3d4d5c] overflow-hidden">
                            <!-- Mobile Card View -->
                            <div class="md:hidden" id="mobileHistoryView">
                                <!-- Cards will be populated by JavaScript -->
                            </div>
                            
                            <!-- Desktop Table View -->
                            <div class="hidden md:block overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="bg-[#141a1f]">
                                            <th class="px-4 py-3 text-left text-white text-sm font-medium">ID</th>
                                            <th class="px-4 py-3 text-left text-white text-sm font-medium">Date</th>
                                            <th class="px-4 py-3 text-left text-white text-sm font-medium">Image Name</th>
                                            <th class="px-4 py-3 text-left text-white text-sm font-medium">Classification</th>
                                            <th class="px-4 py-3 text-left text-white text-sm font-medium">Confidence</th>
                                            <th class="px-4 py-3 text-left text-white text-sm font-medium">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="historyTableBody">
                                        <!-- Data will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Empty State -->
                            <div id="emptyState" class="hidden text-center py-12">
                                <svg class="mx-auto h-12 w-12 text-[#9daebe]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                <h3 class="mt-2 text-sm font-medium text-white">No analysis history</h3>
                                <p class="mt-1 text-sm text-[#9daebe]">Get started by uploading your first image for analysis.</p>
                                <div class="mt-6">
                                    <a href="{{ url_for('upload_page') }}" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-[#141a1f] bg-[#dce8f3] hover:bg-[#b8d4e8] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#dce8f3]">
                                        Upload Image
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pagination -->
                    <div class="px-4 py-3">
                        <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                            <div class="text-[#9daebe] text-sm text-center md:text-left">
                                Showing <span id="showingStart">1</span> to <span id="showingEnd">10</span> of <span id="totalItems">0</span> results
                            </div>
                            <div class="flex space-x-2">
                                <button id="prevPage" class="px-4 py-2 text-[#9daebe] bg-[#1f272e] rounded-lg hover:bg-[#2b3640] disabled:opacity-50 disabled:cursor-not-allowed">
                                    Previous
                                </button>
                                <button id="nextPage" class="px-4 py-2 text-[#9daebe] bg-[#1f272e] rounded-lg hover:bg-[#2b3640] disabled:opacity-50 disabled:cursor-not-allowed">
                                    Next
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
    <script src="{{ url_for('static', filename='theme.js') }}"></script>
    <script>
        // History page specific functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Mobile sidebar toggle
            const mobileMenuButton = document.getElementById('mobileMenuButton');
            const sidebarMenu = document.getElementById('sidebarMenu');
            const closeSidebar = document.getElementById('closeSidebar');
            
            function toggleSidebar() {
                sidebarMenu.classList.toggle('-translate-x-full');
            }
            
            if (mobileMenuButton && sidebarMenu) {
                mobileMenuButton.addEventListener('click', toggleSidebar);
            }
            
            if (closeSidebar) {
                closeSidebar.addEventListener('click', toggleSidebar);
            }
            
            // Close sidebar when clicking outside
            document.addEventListener('click', function(e) {
                if (window.innerWidth < 768 && !sidebarMenu.contains(e.target) && !mobileMenuButton.contains(e.target)) {
                    sidebarMenu.classList.add('-translate-x-full');
                }
            });

            let currentPage = 1;
            const itemsPerPage = 10;
            let allHistoryData = [];
            let filteredData = [];

            // Load history data
            loadHistoryData();

            // Event listeners
            document.getElementById('searchInput').addEventListener('input', filterData);
            document.getElementById('filterResult').addEventListener('change', filterData);
            document.getElementById('sortBy').addEventListener('change', filterData);
            document.getElementById('prevPage').addEventListener('click', () => changePage(-1));
            document.getElementById('nextPage').addEventListener('click', () => changePage(1));

            async function loadHistoryData() {
                try {
                    const response = await fetch('/api/history');
                    if (response.ok) {
                        const data = await response.json();
                        allHistoryData = data.history || [];
                        filteredData = [...allHistoryData];
                        updateStats();
                        renderTable();
                    } else {
                        console.error('Failed to load history data');
                    }
                } catch (error) {
                    console.error('Error loading history data:', error);
                }
            }

            function updateStats() {
                const total = allHistoryData.length;
                const benign = allHistoryData.filter(item => item.prediction === 'Benign').length;
                const malignant = allHistoryData.filter(item => item.prediction === 'Malignant').length;
                const accuracy = total > 0 ? Math.round((benign + malignant) / total * 100) : 0;

                document.getElementById('totalAnalyses').textContent = total;
                document.getElementById('benignCount').textContent = benign;
                document.getElementById('malignantCount').textContent = malignant;
                document.getElementById('accuracyRate').textContent = accuracy + '%';
            }

            function filterData() {
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                const filterResult = document.getElementById('filterResult').value;
                const sortBy = document.getElementById('sortBy').value;

                filteredData = allHistoryData.filter(item => {
                    const matchesSearch = item.name.toLowerCase().includes(searchTerm);
                    const matchesFilter = !filterResult || item.prediction === filterResult;
                    return matchesSearch && matchesFilter;
                });

                // Sort data
                filteredData.sort((a, b) => {
                    switch (sortBy) {
                        case 'date_desc':
                            return new Date(b.date) - new Date(a.date);
                        case 'date_asc':
                            return new Date(a.date) - new Date(b.date);
                        case 'name_asc':
                            return a.name.localeCompare(b.name);
                        case 'name_desc':
                            return b.name.localeCompare(a.name);
                        default:
                            return 0;
                    }
                });

                currentPage = 1;
                renderTable();
            }

            function renderTable() {
                const tableBody = document.getElementById('historyTableBody');
                const mobileView = document.getElementById('mobileHistoryView');
                const emptyState = document.getElementById('emptyState');
                
                if (filteredData.length === 0) {
                    tableBody.innerHTML = '';
                    mobileView.innerHTML = '';
                    emptyState.classList.remove('hidden');
                    updatePagination(0);
                    return;
                }

                emptyState.classList.add('hidden');
                
                const startIndex = (currentPage - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;
                const pageData = filteredData.slice(startIndex, endIndex);

                // Desktop table view
                tableBody.innerHTML = pageData.map(item => `
                    <tr class="border-t border-t-[#3d4d5c] hover:bg-[#141a1f] transition-colors">
                        <td class="px-4 py-3 text-white text-sm">${item.id}</td>
                        <td class="px-4 py-3 text-[#9daebe] text-sm">${formatDate(item.date)}</td>
                        <td class="px-4 py-3 text-[#9daebe] text-sm">${item.name}</td>
                        <td class="px-4 py-3">
                            <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                item.prediction === 'Benign' 
                                    ? 'bg-green-900 text-green-300' 
                                    : 'bg-red-900 text-red-300'
                            }">
                                ${item.prediction}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-[#9daebe] text-sm">${item.confidence || 'High'}</td>
                        <td class="px-4 py-3">
                            <div class="flex space-x-2">
                                <button onclick="viewDetails(${item.id})" class="text-[#dce8f3] hover:text-white text-sm font-medium">
                                    View
                                </button>
                                <button onclick="deleteAnalysis(${item.id})" class="text-red-400 hover:text-red-300 text-sm font-medium">
                                    Delete
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');

                // Mobile card view
                mobileView.innerHTML = pageData.map(item => `
                    <div class="border-b border-[#3d4d5c] p-4 last:border-b-0">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex-1">
                                <h3 class="text-white font-medium text-sm">${item.name}</h3>
                                <p class="text-[#9daebe] text-xs mt-1">ID: ${item.id} â€¢ ${formatDate(item.date)}</p>
                            </div>
                            <span class="px-2 py-1 rounded-full text-xs font-medium ml-2 ${
                                item.prediction === 'Benign' 
                                    ? 'bg-green-900 text-green-300' 
                                    : 'bg-red-900 text-red-300'
                            }">
                                ${item.prediction}
                            </span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-[#9daebe] text-sm">Confidence: ${item.confidence || 'High'}</span>
                            <div class="flex space-x-3">
                                <button onclick="viewDetails(${item.id})" class="text-[#dce8f3] hover:text-white text-sm font-medium">
                                    View
                                </button>
                                <button onclick="deleteAnalysis(${item.id})" class="text-red-400 hover:text-red-300 text-sm font-medium">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');

                updatePagination(filteredData.length);
            }

            function updatePagination(totalItems) {
                const totalPages = Math.ceil(totalItems / itemsPerPage);
                const startItem = (currentPage - 1) * itemsPerPage + 1;
                const endItem = Math.min(currentPage * itemsPerPage, totalItems);

                document.getElementById('showingStart').textContent = totalItems > 0 ? startItem : 0;
                document.getElementById('showingEnd').textContent = endItem;
                document.getElementById('totalItems').textContent = totalItems;

                document.getElementById('prevPage').disabled = currentPage === 1;
                document.getElementById('nextPage').disabled = currentPage === totalPages;
            }

            function changePage(delta) {
                const newPage = currentPage + delta;
                const totalPages = Math.ceil(filteredData.length / itemsPerPage);
                
                if (newPage >= 1 && newPage <= totalPages) {
                    currentPage = newPage;
                    renderTable();
                }
            }

            function formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            }

            // Global functions
            window.viewDetails = async function(id) {
                try {
                    const response = await fetch(`/api/analysis/${id}`);
                    if (response.ok) {
                        const data = await response.json();
                        showDetailsModal(data);
                    } else {
                        alert('Failed to load analysis details');
                    }
                } catch (error) {
                    alert('Error loading details');
                }
            };

            window.deleteAnalysis = async function(id) {
                if (confirm('Are you sure you want to delete this analysis?')) {
                    try {
                        const response = await fetch(`/api/analysis/${id}`, { method: 'DELETE' });
                        if (response.ok) {
                            loadHistoryData();
                        } else {
                            alert('Failed to delete analysis');
                        }
                    } catch (error) {
                        alert('Error deleting analysis');
                    }
                }
            };

            function showDetailsModal(data) {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
                modal.innerHTML = `
                    <div class="bg-[#1f272e] rounded-xl p-6 max-w-md w-full border border-[#3d4d5c] max-h-[90vh] overflow-y-auto">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-white text-lg font-semibold">Analysis Details</h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-[#9daebe] hover:text-white">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="space-y-3">
                            <div><span class="text-[#9daebe]">ID:</span> <span class="text-white">${data.id}</span></div>
                            <div><span class="text-[#9daebe]">Image:</span> <span class="text-white break-words">${data.name}</span></div>
                            <div><span class="text-[#9daebe]">Date:</span> <span class="text-white">${formatDate(data.date)}</span></div>
                            <div><span class="text-[#9daebe]">Prediction:</span> 
                                <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                    data.prediction === 'Benign' 
                                        ? 'bg-green-900 text-green-300' 
                                        : 'bg-red-900 text-red-300'
                                }">${data.prediction}</span>
                            </div>
                            <div><span class="text-[#9daebe]">Confidence:</span> <span class="text-white">${data.confidence}%</span></div>
                            <div class="mt-3">
                                <span class="text-[#9daebe] block mb-2">Classification Probabilities:</span>
                                <div class="space-y-2">
                                    <div class="flex justify-between items-center">
                                        <span class="text-green-300">Benign:</span>
                                        <span class="text-white">${data.benign_probability?.toFixed(1) || '0.0'}%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-red-300">Malignant:</span>
                                        <span class="text-white">${data.malignant_probability?.toFixed(1) || '0.0'}%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) modal.remove();
                });
            };
        });
    </script>
</body>
</html> 